#{extends 'main.html' /}
#{set title:'Home' /}

<div class="hero-unit">
  <h1>Sorting rules</h1>
  <p>Add or edit sorting rules. Rules are applied to the files in the Sortbox folder in your Dropbox.</p>
  <table class="rules table table-bordered">
    <thead>
      <th>When</th>
      <th>Apply to</th>
      <th>Move file to</th>
      <th></th>
    </thead>
    #{list items:rules, as:'rule'}
	  <tr class="rule">
          <td>
	      #{select 'type', value:rule.type }
			  #{option 'EXT_EQ'}Extension equals#{/option}
		      #{option 'NAME_CONTAINS'}Name contains#{/option}
		      #{option 'GLOB'}Name pattern#{/option}
	      #{/select}
          </td>
	      <td><input class="pattern" type="text" value="${rule.pattern}"></td>
	      <td>
            <i class="exp-status icon-folder-close"></i>
            <input class="dest" type="text" value="${rule.dest}">
          </td>
	      <td class="center">
	        <button class="btn btn-danger del">Delete</button>
            <i class="status"></i>
          </td>
        </tr>
    #{/list}
    #{else}
    <tr class="rule">
      <td>
        <select>
          <option value="EXT_EQ">Extension equals</option>
          <option value="NAME_CONTAINS">Name contains</option>
          <option value="GLOB">Name pattern</option>
        </select>
      </td>
      <td>
	      <input class="pattern" type="text">
      </td>
      <td>
        <div class="dest-wrap">
	        <i class="exp-status icon-folder-close"></i>
	        <input class="dest" type="text">
        </div>
      </td>
      <td class="center">
        <button class="btn btn-danger del">Delete</button>
        <i class="status"></i>
      </td>
    </tr>
    #{/else}

    <tr class="new-rule-row">
        <td colspan="3"></td>
        <td class="center">
	        <button class="btn new">New rule</button>
        </td>
    </tr>
    
    <tr class="rule-template">
      <td>
        <select>
          <option value="EXT_EQ">Extension equals</option>
          <option value="NAME_CONTAINS">Name contains</option>
          <option value="GLOB">Name pattern</option>
        </select>
      </td>
      <td>
	      <input class="pattern" type="text">
      </td>
      <td>
        <i class="exp-status icon-folder-close"></i>
        <input class="dest" type="text">
      </td>
      <td class="center">
        <button class="btn btn-danger del">Delete</button>
        <i class="status"></i>
      </td>
    </tr>
  </table>
  <p>
    <a class="btn btn-primary btn-large save">Save</a>
    <a class="btn btn-warning btn-large run-rules">Run rules now</a>
  </p>
  
  <small class="pull-right">
  Rules are applied top to bottom. Rule evaluation stops at first match.
  </small>
</div>

  <div class="row">
    <div class="span6">
        <h2>Recent activity</h2>
        <ul class="moves">
            #{list items:moves, as:'move'}
                #{if move.successful}
	            <li class="failure">Moved <code>${move.fromFile}</code> to <code>${move.toDir}/${move.fromFile}</code>. (${move.when.since()})
                #{/if}
                #{else}
	            <li class="success">Failed to move <code>${move.fromFile}</code> to <code>${move.toDir}/${move.fromFile}</code> since
                                    there is already a file with the same name at the location. (${move.when.since()})
                #{/else}
            #{/list}
        </ul>
        #{else}
            <em>None yet. Create some rules and save files in your Sortbox folder to get going.</em>
        #{/else}
    </div>
  </div>
#{form @process(), method:'POST', id:'run-rules-form'}
#{/form}
#{set 'script'}
<script src="@{'/public/js/editor.js'}"></script>
#{/set}


